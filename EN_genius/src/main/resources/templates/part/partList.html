<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
      <!-- layout:decorate 레이아웃 참고 -->

	<th:block layout:fragment="customTitle">
		<title>부품목록</title>
	</th:block>
	<th:block layout:fragment="customContents">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


		<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/

		var groupCode = /*[[ ${groupCode} ]]*/;

		$(document).ready(function(){
			var checkvalues = [];
			
			console.log(groupCode+"그룹코드");
			$('#groupCode').val(groupCode);
		/*]]*/
			//체크박스클릭시 
			$('input[name=partCheck]').click(function(){
				//경고창 초기화
				$('.card-body').find('h2').empty();
				//$('#left-panel').attr('th:replace','/part/partCart :: partCart');
				var partCheck = $('input[name=partCheck]:checked');
				var butBtn = $('#buyPartBtn');
				var sellBtn = $('#sellPartBtn');
				
				console.log($(this).val());
				
				checkvalues.push($(this).val());
				
				
				$('#cartTable').attr('style','display:block');

				//값이 두개이상일때
				if(partCheck.length > 1){
					butBtn.text('다중부품구매');
					sellBtn.text('다중부품판매');
					
					// 다중버튼활성화후 포스트방식으로 호출
					butBtn.click(function(){
						$('[name=partListForm]').attr({action:'/part/partGroupToOrder',method:'post'});
					});
					//
					sellBtn.click(function(){
						$('[name=partListForm]').attr({action:'/part/partGroupToEstimate',method:'post'});
					});
				}else if(partCheck.length == 1){
					butBtn.text('부품구매');
					sellBtn.text('부품판매');
					butBtn.click(function(){
						$('[name=partListForm]').attr({action:'/part/partListToOrder?'+partCheck ,method:'GET'});
					});
				}
			});
			//모든버튼클릭시
			$('.btn-info').click(function(){
				var partCheck = $('input[name=partCheck]:checked');
				if(partCheck.length == 0){
					$('.card-body').find('h2').empty();
					$('.card-body').append('<h2>체크값을확인하여주세요</h2>');
				}else{
					$('.btn-info').attr('type','submit');
				};
			});
			//저장하기버튼클릭시
			$('#cartAddBtn').click(function(){
				
				$.unique(checkvalues);
				console.log(checkvalues+"<ajax밸류");
				var part;
				//$('#test').text(checkvalues);
				var request = $.ajax({
					url: "/part/cartCall",
					method: "POST",
					data: { 'checkvalues' : checkvalues },
					dataType: "json"
				});
				
				request.done(function( data ) {
					$('#cartTable').children().empty();
					console.log(data);

					for(var i=0; i<data.length;i++){
						part = data[i];
						var partNumber = part.partNumber;
						var partName = part.partName;
						console.log(partNumber);
						$('#cartTable').append('<tr><td>'+[i+1]+'</td><td>'+partNumber+'</td><td>'+partName+'</td></tr>');
					}
					
				});
				request.fail(function( jqXHR, textStatus ) {
					//alert( "Request failed: " + textStatus );
				});
			});
		});
		</script>
		<div class="animated fadeIn">
			<div class="row">
				<div class="col-md-6">
					<div class="card">
						<div class="card-header">
							<strong class="card-title">부품목록</strong>
						</div>
						<div class="card-body">
							<form th:action="@{/part/partListToEstimate(partCheck)}" name="partListForm" >
								<table style="font-size: 12px;" class="table table-striped table-bordered" id="bootstrap-data-table" border="1">
									<tr>
										<td>파트번호</td>
										<td>대분류</td>
										<td>중분류</td>
										<td>제품명</td>
										<td>개수</td>
										<td>판매가격</td>
										<td>등록자</td>
										<td>업데이트일자</td>
									</tr>
									<tr th:each=p:${partList}>
										<td><input type="checkbox" th:text="${p.partNumber}" th:partNumber="${p.partNumber}" th:value="${p.partNumber}" name="partCheck"></td>
										<td th:text="${p.bigCate}" th:value="${p.bigCate}"></td>
										<td th:text="${p.midCate}" th:value="${p.midCate}"></td>
										<td th:text="${p.partName}" th:value="${p.partName}"></td>
										<td th:text="${p.partMany}" th:value="${p.partMany}"></td>
										<td th:text="${p.partPrice}" th:value="${p.partPrice}"></td>
										<td th:text="${p.partWrite}" th:value="${p.partWrite}"></td>
										<td th:text="${p.partUpdateDate}" th:value="${p.partUpdateDate}"></td>
									</tr>
								</table>
								<input type="hidden"  id="groupCode" name="groupCode">
								<button class="btn-info" type="button" id="sellPartBtn">부품판매</button>
								<button class="btn-info" type="button" id="buyPartBtn">부품구매</button>
							</form>
							<button class="btn-info" type="button" id="cartAddBtn">저장하기</button>
						</div>
					</div>
							<th:block th:replace="/part/partCart :: partCart">
							
							</th:block>
				</div>
			</div>
		</div>
	</th:block>
</html>